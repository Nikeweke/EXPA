<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Forms + JWT - auth | Expa</title>
    <meta name="description" content="Experience from IT world">
    
    
    <link rel="preload" href="/EXPA/assets/css/0.styles.7fd1fbfe.css" as="style"><link rel="preload" href="/EXPA/assets/js/app.b8bf5531.js" as="script"><link rel="preload" href="/EXPA/assets/js/8.cac08497.js" as="script"><link rel="prefetch" href="/EXPA/assets/js/10.8af346fc.js"><link rel="prefetch" href="/EXPA/assets/js/11.06392a8c.js"><link rel="prefetch" href="/EXPA/assets/js/12.fe098724.js"><link rel="prefetch" href="/EXPA/assets/js/13.b3d2a054.js"><link rel="prefetch" href="/EXPA/assets/js/14.e14dee0f.js"><link rel="prefetch" href="/EXPA/assets/js/15.ec95653f.js"><link rel="prefetch" href="/EXPA/assets/js/16.bdb2f5f0.js"><link rel="prefetch" href="/EXPA/assets/js/17.065fb7e7.js"><link rel="prefetch" href="/EXPA/assets/js/18.76198b75.js"><link rel="prefetch" href="/EXPA/assets/js/19.aba78603.js"><link rel="prefetch" href="/EXPA/assets/js/2.04a976bb.js"><link rel="prefetch" href="/EXPA/assets/js/20.37ad25a6.js"><link rel="prefetch" href="/EXPA/assets/js/21.0c182164.js"><link rel="prefetch" href="/EXPA/assets/js/22.54f1c45d.js"><link rel="prefetch" href="/EXPA/assets/js/23.8ed835e5.js"><link rel="prefetch" href="/EXPA/assets/js/24.6b7056ce.js"><link rel="prefetch" href="/EXPA/assets/js/25.0e4da2d6.js"><link rel="prefetch" href="/EXPA/assets/js/26.16fc347f.js"><link rel="prefetch" href="/EXPA/assets/js/27.d71dc88c.js"><link rel="prefetch" href="/EXPA/assets/js/28.110a37a9.js"><link rel="prefetch" href="/EXPA/assets/js/29.37df2970.js"><link rel="prefetch" href="/EXPA/assets/js/3.e4146212.js"><link rel="prefetch" href="/EXPA/assets/js/30.7caefef9.js"><link rel="prefetch" href="/EXPA/assets/js/31.249cc97b.js"><link rel="prefetch" href="/EXPA/assets/js/32.6561dbb0.js"><link rel="prefetch" href="/EXPA/assets/js/33.ef87c3a9.js"><link rel="prefetch" href="/EXPA/assets/js/34.e6bf88c2.js"><link rel="prefetch" href="/EXPA/assets/js/35.36d0520a.js"><link rel="prefetch" href="/EXPA/assets/js/36.67cd47a0.js"><link rel="prefetch" href="/EXPA/assets/js/37.d1b26191.js"><link rel="prefetch" href="/EXPA/assets/js/38.e70f654c.js"><link rel="prefetch" href="/EXPA/assets/js/4.8fca95e3.js"><link rel="prefetch" href="/EXPA/assets/js/5.3296e5b3.js"><link rel="prefetch" href="/EXPA/assets/js/6.74df61f1.js"><link rel="prefetch" href="/EXPA/assets/js/7.92b9cc8f.js"><link rel="prefetch" href="/EXPA/assets/js/9.64b6b507.js">
    <link rel="stylesheet" href="/EXPA/assets/css/0.styles.7fd1fbfe.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/EXPA/" class="home-link router-link-active"><!----> <span class="site-name">Expa</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/EXPA/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/Nikeweke/EXPA/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  To repository
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/EXPA/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/Nikeweke/EXPA/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  To repository
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/EXPA/introduction.html" class="sidebar-link">Intro (links)</a></li><li><a href="/EXPA/starter-kit.html" class="sidebar-link">Starter Kit for programming</a></li><li><a href="/EXPA/technologies.html" class="sidebar-link">Technologies</a></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Frontend</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Tools</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Mobile development</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Deploying</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Authentications</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/EXPA/authes/intro.html" class="sidebar-link">Аутентификации</a></li><li><a href="/EXPA/authes/forms-jwt.html" class="active sidebar-link">Forms + JWT - auth</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/EXPA/authes/oauth.html" class="sidebar-link">OAuth</a></li><li><a href="/EXPA/authes/oauth-google.html" class="sidebar-link">Google Auth</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="forms-jwt-auth"><a href="#forms-jwt-auth" aria-hidden="true" class="header-anchor">#</a> Forms + JWT - auth</h1> <ul><li><a href="https://medium.com/@bitshadow/how-basic-http-authentication-and-session-works-d29af9caec31" target="_blank" rel="noopener noreferrer">How to make basic http auth - without jwt<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://medium.com/vandium-software/5-easy-steps-to-understanding-json-web-tokens-jwt-1164c0adfcec" target="_blank" rel="noopener noreferrer">5 steps understand jwt-auth<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://hackernoon.com/how-do-you-authenticate-mate-f2b70904cc3a" target="_blank" rel="noopener noreferrer">Authentication nowadays<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h4 id="содержание"><a href="#содержание" aria-hidden="true" class="header-anchor">#</a> Содержание</h4> <p></p><div class="table-of-contents"><ul><li><a href="#сценарий-аутентификации-и-авторизации">Сценарий аутентификации и авторизации</a></li><li><a href="#quick-sample">Quick sample</a></li></ul></div><p></p> <hr> <h3 id="сценарий-аутентификации-и-авторизации"><a href="#сценарий-аутентификации-и-авторизации" aria-hidden="true" class="header-anchor">#</a> Сценарий аутентификации и авторизации</h3> <ol><li><p>Клинет отсылает свои данные(<code>username, password</code>), на сервер.</p></li> <li><p>Сервер смотрит есть ли такой пользователь в системе, если нет - то переход на логин страницу.</p></li> <li><p>Если есть пользователь - то сервер отсылает данные о пользователе(необъязательно, могут быть и payload токена) и его токен(JWT), без его пароля. Токен(<code>access_token</code> - это jwt-токен, название может быть произволным) генерируеться на сервере с секретом.</p></li> <li><p>Клиент получает  токен ставит в куки по инструкции сервера(Set-Cookie). Если получает данные о пользователе и устанавливает их в <code>localStorage</code>, если они пришли. Если кук не будет, то клиент каждый раз должен будет проходить авторизацию.</p></li> <li><p>При каждом запросе клиента, сервер вынимает из кук <code>access_token</code> и проверяет(jwt.verify), если удалось расшифровать токен с помощью секрета сервера, то пользователь наш. Тогда мы можем достать инфу из токена и дать пользователю запрашиваемую инфу.</p></li></ol> <blockquote><p>Если подписи совпадают, то это означает, что JWT является действительным, что указывает на то, что вызов API поступает из подлинного источника. В противном случае, если подписи не совпадают, это означает, что полученный JWT является недействительным, что может быть индикатором потенциальной атаки на приложение. Таким образом, проверяя JWT, приложение добавляет уровень доверия между собой и пользователем.</p></blockquote> <ol start="6"><li>Выход - осуществляется удалением токена из кук</li></ol> <h3 id="quick-sample"><a href="#quick-sample" aria-hidden="true" class="header-anchor">#</a> Quick sample</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> jwt     <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'jsonwebtoken'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app        <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token constant">JWT_SECRET</span> <span class="token operator">=</span> <span class="token string">'supersecret'</span>

<span class="token comment">// Зарегистрируйем домашний маршрут, который отображает приветственное сообщение</span>
<span class="token comment">// К этому маршруту можно получить доступ без токена</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;Welcome to our API&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// Зарегистрируем маршрут, чтобы получить новый токен</span>
<span class="token comment">// В реальном мире мы бы аутентифицировали учетные данные пользователя</span>
<span class="token comment">// перед созданием токена, но для простоты доступа к этому маршруту</span>
<span class="token comment">// создаст новый токен, действительный в течение 2 минут</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/token'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> token <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token punctuation">{</span> username<span class="token punctuation">:</span><span class="token string">'ado'</span><span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token constant">JWT_SECRET</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>expiresIn<span class="token punctuation">:</span> <span class="token number">120</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// Зарегистрируем маршрут, который требует действительный токен для просмотра данных</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> token <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>token

  <span class="token comment">// Даже не нужно лезть в БД для проверки пользователя,</span>
  <span class="token comment">// достаточно проверить токен с помощью своего ключа,</span>
  <span class="token comment">// и если все ок - значит это наш токен, пользователь аутентифицирован</span>
  jwt<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> <span class="token constant">JWT_SECRET</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> decoded</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>decoded<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> secrets <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;accountNumber&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;938291239&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;pin&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;11289&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;account&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;Finance&quot;</span><span class="token punctuation">}</span>
      res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>secrets<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// Launch our app</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">8000</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'JWT listening on port '</span> <span class="token operator">+</span> port<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/EXPA/authes/intro.html" class="prev">
          Аутентификации
        </a></span> <span class="next"><a href="/EXPA/authes/oauth.html">
          OAuth
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/EXPA/assets/js/app.b8bf5531.js" defer></script><script src="/EXPA/assets/js/8.cac08497.js" defer></script>
  </body>
</html>
